---
description: 
globs: 
alwaysApply: true
---
# åŒ»ç–—å½±åƒæ¨¡å‹ç®¡ç†å¹³å° - å¼‚å¸¸å¤„ç†å’ŒAPIè¿”å›ä½“ç³»è§„èŒƒ

## ğŸ¯ æ ¸å¿ƒè§„èŒƒ

### APIå“åº”æ ¼å¼
- **æ‰€æœ‰Controlleræ¥å£å¿…é¡»è¿”å›ApiResult<T>ç±»å‹**
- **ç¦æ­¢ç›´æ¥è¿”å›å®ä½“ç±»æˆ–åŸºç¡€ç±»å‹**
- **ç»Ÿä¸€ä½¿ç”¨success()å’Œerror()æ–¹æ³•æ„å»ºå“åº”**

### å¼‚å¸¸å¤„ç†æœºåˆ¶
- **Serviceå±‚é‡åˆ°ä¸šåŠ¡é”™è¯¯å¿…é¡»æŠ›å‡ºServiceException**
- **Controllerå±‚ä¸è¦æ•è·ServiceExceptionï¼Œè®©å…¶ä¼ æ’­åˆ°GlobalExceptionHandler**

### é”™è¯¯ç ç®¡ç†
- **å¿…é¡»ä½¿ç”¨ErrorCodeæšä¸¾ä¸­å®šä¹‰çš„é”™è¯¯ç **
- **å¦‚æœErrorCodeä¸­æ²¡æœ‰åˆé€‚çš„é”™è¯¯ç ï¼Œå…è®¸æ·»åŠ æ–°çš„é”™è¯¯ç **
- **æ–°å¢é”™è¯¯ç å¿…é¡»æŒ‰æ¨¡å—èŒƒå›´åˆ†ç±»ï¼ˆè§ä¸‹æ–¹é”™è¯¯ç èŒƒå›´ï¼‰**

## ğŸ“š APIä½¿ç”¨è§„èŒƒ

### ApiResultä½¿ç”¨æ–¹æ³•
```java
// âœ… æ­£ç¡®çš„æˆåŠŸå“åº”
return ApiResult.success();                    // æˆåŠŸï¼Œæ— æ•°æ®
return ApiResult.success(data);                // æˆåŠŸï¼Œè¿”å›æ•°æ®  
return ApiResult.success("æ“ä½œå®Œæˆ");           // æˆåŠŸï¼Œè‡ªå®šä¹‰æ¶ˆæ¯
return ApiResult.success("ä¿å­˜æˆåŠŸ", data);     // æˆåŠŸï¼Œè‡ªå®šä¹‰æ¶ˆæ¯å’Œæ•°æ®

// âœ… æ­£ç¡®çš„å¤±è´¥å“åº”
return ApiResult.error(ErrorCode.NOT_FOUND);           // ä½¿ç”¨é”™è¯¯ç 
return ApiResult.error(ErrorCode.NOT_FOUND, "ç”¨æˆ·ä¸å­˜åœ¨");  // é”™è¯¯ç +è‡ªå®šä¹‰æ¶ˆæ¯
return ApiResult.error("æ“ä½œå¤±è´¥");                      // è‡ªå®šä¹‰æ¶ˆæ¯
return ApiResult.error(1001, "è‡ªå®šä¹‰é”™è¯¯");              // è‡ªå®šä¹‰é”™è¯¯ç å’Œæ¶ˆæ¯

// âŒ é”™è¯¯çš„åšæ³•
return user;                                   // ç¦æ­¢ç›´æ¥è¿”å›å®ä½“
return "success";                              // ç¦æ­¢è¿”å›å­—ç¬¦ä¸²
return ResponseEntity.ok(data);                // ç¦æ­¢ä½¿ç”¨ResponseEntity
```

### ServiceExceptionä½¿ç”¨æ–¹æ³•
```java

// âœ… åŸºæœ¬ä½¿ç”¨æ–¹æ³•
throw new ServiceException("ç”¨æˆ·ä¸å­˜åœ¨");                           // è‡ªå®šä¹‰æ¶ˆæ¯
throw new ServiceException(ErrorCode.DATA_NOT_FOUND);              // ä½¿ç”¨é”™è¯¯ç 
throw new ServiceException(ErrorCode.OPERATION_NOT_ALLOWED, "è´¦æˆ·å·²é”å®š"); // é”™è¯¯ç +è‡ªå®šä¹‰æ¶ˆæ¯

// âŒ é”™è¯¯çš„åšæ³•
throw new RuntimeException("é”™è¯¯");            // ç¦æ­¢ä½¿ç”¨RuntimeException
throw new IllegalArgumentException("å‚æ•°é”™è¯¯"); // ç¦æ­¢ä½¿ç”¨æ ‡å‡†å¼‚å¸¸
return null;                                   // ç¦æ­¢è¿”å›nullè¡¨ç¤ºé”™è¯¯
```

## ğŸ”§ ErrorCodeé”™è¯¯ç èŒƒå›´

### å½“å‰å·²å®šä¹‰çš„é”™è¯¯ç èŒƒå›´ï¼š
- **200**: æˆåŠŸçŠ¶æ€
- **400-499**: å®¢æˆ·ç«¯é”™è¯¯
- **500-599**: æœåŠ¡ç«¯é”™è¯¯  
- **1000-1099**: å‚æ•°éªŒè¯é”™è¯¯
- **1100-1199**: æ–‡ä»¶æ“ä½œé”™è¯¯
- **1200-1299**: æ•°æ®åº“æ“ä½œé”™è¯¯
- **1300-1399**: ä¸šåŠ¡é€»è¾‘é”™è¯¯
- **1400-1499**: ä»»åŠ¡ç›¸å…³é”™è¯¯
- **1500-1599**: æ¨¡å‹ç›¸å…³é”™è¯¯
- **1600-1699**: å¤–éƒ¨æœåŠ¡é”™è¯¯

### é¢„ç•™çš„æ¨¡å—é”™è¯¯ç èŒƒå›´ï¼ˆå¯æ‰©å±•ï¼‰ï¼š
- **1700-1799**: ç”¨æˆ·è®¤è¯ç›¸å…³é”™è¯¯
- **1800-1899**: æƒé™ç®¡ç†ç›¸å…³é”™è¯¯
- **1900-1999**: ç§¯åˆ†ç³»ç»Ÿç›¸å…³é”™è¯¯
- **2000-2099**: åŒ»ç–—å½±åƒç›¸å…³é”™è¯¯
- **2100-2199**: AIæ¨¡å‹è®­ç»ƒç›¸å…³é”™è¯¯
- **2200-2299**: æŠ¥å‘Šç”Ÿæˆç›¸å…³é”™è¯¯
- **2300-2399**: å®¡è®¡æ—¥å¿—ç›¸å…³é”™è¯¯
- **2400-2499**: ç³»ç»Ÿé…ç½®ç›¸å…³é”™è¯¯

### æ·»åŠ æ–°é”™è¯¯ç çš„è§„èŒƒï¼š
```java
// âœ… æ­£ç¡®çš„æ–°å¢æ–¹å¼ - åœ¨ErrorCode.javaä¸­æŒ‰èŒƒå›´æ·»åŠ 
// ç”¨æˆ·è®¤è¯ç›¸å…³é”™è¯¯ 1700-1799
USER_NOT_FOUND(1701, "ç”¨æˆ·ä¸å­˜åœ¨"),
USER_PASSWORD_WRONG(1702, "å¯†ç é”™è¯¯"),
USER_ACCOUNT_LOCKED(1703, "è´¦æˆ·å·²é”å®š"),
USER_TOKEN_EXPIRED(1704, "ç™»å½•ä»¤ç‰Œå·²è¿‡æœŸ"),

// æƒé™ç®¡ç†ç›¸å…³é”™è¯¯ 1800-1899  
PERMISSION_DENIED(1801, "æƒé™ä¸è¶³"),
ROLE_NOT_FOUND(1802, "è§’è‰²ä¸å­˜åœ¨"),
ROLE_ALREADY_EXISTS(1803, "è§’è‰²å·²å­˜åœ¨"),

// ç§¯åˆ†ç³»ç»Ÿç›¸å…³é”™è¯¯ 1900-1999
CREDIT_INSUFFICIENT(1901, "ç§¯åˆ†ä½™é¢ä¸è¶³"),
CREDIT_TYPE_INVALID(1902, "ç§¯åˆ†ç±»å‹æ— æ•ˆ"),
CREDIT_TRANSFER_FAILED(1903, "ç§¯åˆ†è½¬è´¦å¤±è´¥"),
```

## ğŸ“ ä»£ç ç¼–å†™è§„èŒƒ

### Controllerå±‚è§„èŒƒ
```java
@RestController
@RequestMapping("/api/users")
public class UserController {
    
    // âœ… æ ‡å‡†çš„Controlleræ–¹æ³•
    @GetMapping("/{id}")
    public ApiResult<User> getUser(@PathVariable Long id) {
        User user = userService.getById(id);
        return ApiResult.success(user);
    }
    
    @PostMapping
    public ApiResult<User> createUser(@RequestBody @Valid UserRequest request) {
        User user = userService.create(request);
        return ApiResult.success("ç”¨æˆ·åˆ›å»ºæˆåŠŸ", user);
    }
    
    @DeleteMapping("/{id}")
    public ApiResult<Void> deleteUser(@PathVariable Long id) {
        userService.delete(id);
        return ApiResult.success("ç”¨æˆ·åˆ é™¤æˆåŠŸ");
    }
    
    // âŒ é”™è¯¯çš„Controlleræ–¹æ³•
    @GetMapping("/wrong/{id}")
    public User getWrongUser(@PathVariable Long id) {  // ç¦æ­¢ç›´æ¥è¿”å›å®ä½“
        return userService.getById(id);
    }
}
```

### Serviceå±‚è§„èŒƒ
```java
@Service
public class UserService {
    
    // âœ… æ ‡å‡†çš„Serviceæ–¹æ³•
    public User getById(Long id) {
        User user = userMapper.selectById(id);
        if (user == null) {
            // ä¸»åŠ¨æŠ›å‡ºä¸šåŠ¡å¼‚å¸¸
            throw ServiceException.dataNotFound("ç”¨æˆ·ä¸å­˜åœ¨: " + id);
        }
        return user;
    }
    
    public User create(UserRequest request) {
        // ä¸šåŠ¡è§„åˆ™éªŒè¯
        if (userMapper.existsByEmail(request.getEmail())) {
            throw ServiceException.dataAlreadyExists("é‚®ç®±å·²è¢«ä½¿ç”¨");
        }
        
        if (request.getAge() < 18) {
            throw ServiceException.paramInvalid("å¹´é¾„å¿…é¡»å¤§äºç­‰äº18å²");
        }
        
        // æ­£å¸¸ä¸šåŠ¡é€»è¾‘
        User user = new User();
        // ... è®¾ç½®ç”¨æˆ·ä¿¡æ¯
        userMapper.insert(user);
        return user;
    }
    
    // âŒ é”™è¯¯çš„Serviceæ–¹æ³•
    public User getBadExample(Long id) {
        User user = userMapper.selectById(id);
        if (user == null) {
            return null;  // ç¦æ­¢è¿”å›nullè¡¨ç¤ºé”™è¯¯
        }
        return user;
    }
}
```

### å‚æ•°éªŒè¯è§„èŒƒ
```java
// âœ… ä½¿ç”¨@Validæ³¨è§£è¿›è¡Œå‚æ•°éªŒè¯
@PostMapping
public ApiResult<User> createUser(@RequestBody @Valid UserRequest request) {
    // @Validä¼šè‡ªåŠ¨è§¦å‘å‚æ•°éªŒè¯ï¼Œå¤±è´¥æ—¶GlobalExceptionHandlerä¼šç»Ÿä¸€å¤„ç†
    User user = userService.create(request);
    return ApiResult.success(user);
}

// âœ… æ‰‹åŠ¨å‚æ•°éªŒè¯æ—¶æŠ›å‡ºServiceException
public void validateUser(UserRequest request) {
    if (StringUtils.isEmpty(request.getEmail())) {
        throw ServiceException.paramInvalid("é‚®ç®±ä¸èƒ½ä¸ºç©º");
    }
    if (request.getAge() < 0 || request.getAge() > 150) {
        throw ServiceException.paramInvalid("å¹´é¾„å¿…é¡»åœ¨0-150ä¹‹é—´");
    }
}
```

## ğŸ¯ æœ€ä½³å®è·µåŸåˆ™

### 1. Controllerå±‚åŸåˆ™
- **åªè¿”å›ApiResult**: æ‰€æœ‰æ¥å£éƒ½ä½¿ç”¨ApiResultåŒ…è£…
- **ç®€åŒ–é€»è¾‘**: ä¸šåŠ¡é€»è¾‘äº¤ç»™Serviceå±‚ï¼ŒControlleråªè´Ÿè´£å‚æ•°éªŒè¯å’Œç»“æœè¿”å›
- **å¼‚å¸¸é€ä¼ **: è®©ServiceExceptionå‘ä¸Šä¼ æ’­ï¼Œç”±GlobalExceptionHandlerå¤„ç†
- **ç»Ÿä¸€æ ¼å¼**: æ‰€æœ‰å“åº”æ ¼å¼ä¿æŒä¸€è‡´

### 2. Serviceå±‚åŸåˆ™  
- **ä¸»åŠ¨æŠ›å¼‚å¸¸**: é‡åˆ°ä¸šåŠ¡é”™è¯¯æ—¶ä¸»åŠ¨æŠ›å‡ºServiceException
- **ä½¿ç”¨é™æ€æ–¹æ³•**: ä¼˜å…ˆä½¿ç”¨ServiceExceptionçš„é™æ€å·¥å‚æ–¹æ³•
- **é”™è¯¯ç é€‰æ‹©**: é€‰æ‹©åˆé€‚çš„ErrorCodeï¼Œå¿…è¦æ—¶è‡ªå®šä¹‰æ¶ˆæ¯
- **ä¸šåŠ¡èšç„¦**: ä¸“æ³¨ä¸šåŠ¡é€»è¾‘ï¼Œä¸å¤„ç†HTTPå“åº”æ ¼å¼

### 3. é”™è¯¯ç ä½¿ç”¨åŸåˆ™
- **æŒ‰æ¨¡å—åˆ†ç±»**: ä½¿ç”¨å¯¹åº”æ¨¡å—èŒƒå›´å†…çš„é”™è¯¯ç 
- **è¯­ä¹‰æ˜ç¡®**: é€‰æ‹©è¯­ä¹‰æœ€æ¥è¿‘çš„é”™è¯¯ç 
- **è‡ªå®šä¹‰æ¶ˆæ¯**: å½“é»˜è®¤æ¶ˆæ¯ä¸å¤Ÿå…·ä½“æ—¶ï¼Œæä¾›è‡ªå®šä¹‰æ¶ˆæ¯
- **èŒƒå›´é¢„ç•™**: ä¸ºæ–°æ¨¡å—é¢„ç•™è¶³å¤Ÿçš„é”™è¯¯ç ç©ºé—´

### 4. å¼‚å¸¸å¤„ç†åŸåˆ™
- **ä¸è¦æ•è·ServiceException**: è®©å®ƒä¼ æ’­åˆ°GlobalExceptionHandler
- **è®°å½•å…³é”®ä¿¡æ¯**: åœ¨Serviceå±‚è®°å½•å…³é”®æ“ä½œæ—¥å¿—
- **ç”¨æˆ·å‹å¥½**: å¼‚å¸¸æ¶ˆæ¯è¦å¯¹ç”¨æˆ·å‹å¥½ï¼Œé¿å…æŠ€æœ¯ç»†èŠ‚
- **ç»Ÿä¸€å¤„ç†**: æ‰€æœ‰å¼‚å¸¸éƒ½ç”±GlobalExceptionHandlerç»Ÿä¸€å¤„ç†

## ğŸš« ç¦æ­¢è¡Œä¸º

### ç»å¯¹ç¦æ­¢çš„åšæ³•ï¼š
1. **Controllerç›´æ¥è¿”å›å®ä½“ç±»æˆ–åŸºç¡€ç±»å‹**
2. **ä½¿ç”¨RuntimeExceptionæˆ–æ ‡å‡†Javaå¼‚å¸¸ä»£æ›¿ServiceException**
3. **åœ¨Controllerå±‚æ•è·ServiceException**
4. **è¿”å›nullè¡¨ç¤ºä¸šåŠ¡é”™è¯¯**
5. **ä½¿ç”¨ResponseEntityä»£æ›¿ApiResult**
6. **ç¡¬ç¼–ç é”™è¯¯ç ï¼Œä¸ä½¿ç”¨ErrorCodeæšä¸¾**
7. **è·¨æ¨¡å—ä½¿ç”¨é”™è¯¯ç ï¼ˆå¦‚åœ¨ç”¨æˆ·æ¨¡å—ä½¿ç”¨æ–‡ä»¶æ¨¡å—çš„é”™è¯¯ç ï¼‰**

### ç¼–ç æ—¶å¿…é¡»æ£€æŸ¥ï¼š
- âœ… æ˜¯å¦ä½¿ç”¨äº†ApiResultåŒ…è£…è¿”å›ç»“æœï¼Ÿ
- âœ… æ˜¯å¦åœ¨é€‚å½“çš„åœ°æ–¹æŠ›å‡ºäº†ServiceExceptionï¼Ÿ
- âœ… æ˜¯å¦ä½¿ç”¨äº†åˆé€‚çš„ErrorCodeï¼Ÿ
- âœ… å¼‚å¸¸æ¶ˆæ¯æ˜¯å¦ç”¨æˆ·å‹å¥½ï¼Ÿ
- âœ… æ˜¯å¦éµå¾ªäº†æ¨¡å—é”™è¯¯ç èŒƒå›´ï¼Ÿ

## ğŸ“‹ å“åº”æ ¼å¼ç¤ºä¾‹

### æˆåŠŸå“åº”æ ¼å¼
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "id": 1,
    "name": "å¼ ä¸‰",
    "email": "zhangsan@example.com"
  },
  "timestamp": 1673836800000
}
```

### å¤±è´¥å“åº”æ ¼å¼
```json
{
  "code": 1701,
  "message": "ç”¨æˆ·ä¸å­˜åœ¨",
  "data": null,
  "timestamp": 1673836800000
}
```

è¿™å¥—å¼‚å¸¸å¤„ç†å’ŒAPIè¿”å›ä½“ç³»ç¡®ä¿äº†ä»£ç çš„ä¸€è‡´æ€§ã€å¯ç»´æŠ¤æ€§å’Œç”¨æˆ·ä½“éªŒçš„ç»Ÿä¸€æ€§ã€‚éµå¾ªè¿™äº›è§„èŒƒå°†è®©å¼€å‘æ›´åŠ é«˜æ•ˆå’Œè§„èŒƒã€‚ 