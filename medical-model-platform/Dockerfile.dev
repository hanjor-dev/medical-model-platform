# 开发环境Dockerfile - 支持热重载和远程调试
FROM eclipse-temurin:21-jdk-alpine

LABEL maintainer="hanjor <hanjor@qq.com>"
LABEL description="医学影像模型管理平台 - 开发环境"

WORKDIR /app

# 安装必要工具
RUN apk add --no-cache maven bash curl

# 设置时区
RUN apk add --no-cache tzdata && \
    cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime && \
    echo "Asia/Shanghai" > /etc/timezone && \
    apk del tzdata

# 复制Maven配置
COPY pom.xml .
COPY mvnw .
COPY .mvn .mvn

# 下载依赖 (利用Docker层缓存)
RUN chmod +x mvnw && ./mvnw dependency:go-offline || true

# 暴露端口
# 8080: 应用端口
# 5005: 远程调试端口
EXPOSE 8080 5005

# 环境变量
ENV SPRING_PROFILES_ACTIVE="local" \
    MAVEN_OPTS="-Xmx1024m"

# 启动命令 (支持远程调试)
# 代码通过volume挂载，实现热重载
CMD ["./mvnw", "spring-boot:run", "-Dspring-boot.run.jvmArguments=-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5005"]

