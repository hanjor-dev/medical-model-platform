# 医学影像模型管理平台需求说明文档

**项目名称**: 医学影像模型管理平台  
**项目代码**: medical-model-platform  
**版本**: v2.0.0  
**创建时间**: 2025-01-14  
**文档状态**: 正式版本  

## 1. 项目概述

### 1.1 项目背景
医学影像模型管理平台是一个专业的医学影像处理业务系统，专注于用户业务逻辑处理，与AI计算引擎完全解耦。系统承担业务流程管理、用户交互、数据管理等职责，通过标准化接口与AI计算引擎协作，实现高效的医学影像处理服务。

### 1.2 项目目标
- 提供完整的用户管理和权限控制体系
- 实现高效的任务编排和调度管理
- 建立灵活的积分管理和计费系统
- 构建可靠的文件存储和管理服务
- 支持实时的任务状态通信和反馈
- 管理AI计算引擎的注册和负载均衡

### 1.3 系统定位
- 微服务架构中的业务逻辑层
- 面向用户的前端服务接口
- AI计算任务的编排调度中心
- 业务数据的统一管理平台

## 2. 功能需求

### 2.1 用户管理模块

#### 2.1.1 用户注册功能
**需求描述**: 提供新用户注册功能，支持用户账号创建和初始化

**功能要求**:
- 有推荐码机制，注册时可以输入推荐码，双方可以获得配置的引荐积分奖励
- 用户名唯一性验证，防止重复注册
- 密码强度验证，确保账号安全
- 邮箱格式验证和手机号验证（非必要）
- 自动分配默认用户角色
- 注册成功后自动初始化用户积分

**验收标准**:
- 用户名重复时给出明确提示
- 密码必须符合安全策略要求
- 注册成功后用户可正常登录
- 新用户默认分配USER角色

#### 2.1.2 用户登录认证
**需求描述**: 实现安全的用户登录认证机制

**功能要求**:
- 支持用户名/邮箱 + 密码登录
- JWT Token无状态认证机制
- 登录失败次数限制，防止暴力破解
- 用户状态检查，禁止被禁用用户登录
- Token自动刷新和过期处理

**验收标准**:
- 用户名或密码错误时给出提示
- 连续登录失败超过限制时锁定账号
- Token有效期内用户无需重复登录
- 被禁用用户无法登录系统

#### 2.1.3 权限管理体系
**需求描述**: 建立基于角色的权限控制系统

**功能要求**:
- 三级角色体系：USER、ADMIN、SUPER_ADMIN
- USER用户只能访问和操作自己的数据,ADMIN可以访问和操作自己的和其下关联的USER用户数据（admin用户可以在用户列表直接添加子账号，那么该账号就是属于该admin账户其下关联）
- 管理员可以管理子账号和分配积分
- 超级管理员拥有系统完全管理权限
- 权限检查覆盖所有敏感操作
- 角色权限可配置菜单、按钮等关键功能权限，不同角色账号前端功能不同

**验收标准**:
- 普通用户无法访问他人数据
- 管理员可以查看和管理子账号
- 权限不足时返回明确的错误信息
- 所有接口都有相应的权限验证

### 2.2 文件管理模块

#### 2.2.1 医学影像文件上传
**需求描述**: 支持医学影像文件的安全上传和存储，支持配置OSS存储、本地存储两种方式

**功能要求**:
- 支持ZIP格式医学影像文件上传
- 文件大小、类型等限制可通过系统配置调整
- 文件格式验证，确保数据有效性
- 根据配置存储方式自动处理是上传到阿里云OSS存储还是本地存储
- 上传进度实时显示和断点续传

**验收标准**:
- 只接受有效的格式文件
- 超过大小限制的文件被拒绝
- 上传失败时有明确的错误提示
- 上传成功后文件可以正常访问

#### 2.2.2 STL三维模型文件管理
**需求描述**: 管理AI计算结果生成的STL三维模型文件

**功能要求**:
- 支持STL格式三维模型文件上传
- 文件与计算任务自动关联
- 支持批量文件上传操作
- 文件访问权限控制
- 文件下载和预览功能

**验收标准**:
- STL文件正确关联到对应任务
- 用户只能访问自己的模型文件
- 批量上传时所有文件都成功处理
- 文件下载链接具有时效性

#### 2.2.3 文件存储策略
**需求描述**: 实现高效可靠的文件存储管理

**功能要求**:
- 云端存储与本地缓存结合
- 文件生命周期自动管理
- 临时文件定期清理
- 文件访问URL动态生成
- 支持文件压缩和解压缩

**验收标准**:
- 文件存储具有高可用性
- 临时文件不会长期占用空间
- 文件访问URL安全可控
- 文件操作性能满足用户需求

### 2.3 任务管理模块

#### 2.3.1 任务创建和编排
**需求描述**: 自动创建和编排AI计算任务

**功能要求**:
- 用户上传文件时自动创建任务
- 生成唯一的任务订单号
- 支持任务参数配置
- 任务优先级设置和管理
- 任务与用户和文件的关联

**验收标准**:
- 每个任务都有唯一标识
- 任务参数配置正确有效
- 高优先级任务优先处理
- 任务信息完整准确

#### 2.3.2 任务调度分发
**需求描述**: 智能分发任务到AI计算引擎

**功能要求**:
- 自动选择可用的计算引擎
- 负载均衡算法分配任务
- 任务队列管理和监控
- 任务分发失败时的处理
- 引擎故障时的任务转移

**验收标准**:
- 任务能够合理分配到各个引擎
- 负载均衡效果明显
- 任务队列不会无限增长
- 引擎故障不影响任务执行

#### 2.3.3 任务状态管理
**需求描述**: 全生命周期的任务状态管理

**功能要求**:
- 完整的任务状态流转
- 实时任务状态更新
- 任务执行进度跟踪
- 任务超时检测和处理
- 任务失败重试机制

**验收标准**:
- 任务状态变化及时准确
- 用户可以实时查看任务进度
- 超时任务自动标记失败
- 失败任务能够自动重试

#### 2.3.4 任务监控和故障处理
**需求描述**: 监控任务执行状态并处理异常情况

**功能要求**:
- 定时监控运行中的任务
- 自动检测任务超时和异常
- 任务心跳检测机制
- 故障任务自动恢复
- 任务执行统计和报告

**验收标准**:
- 异常任务能够及时发现
- 故障处理机制有效可靠
- 任务监控不影响系统性能
- 监控数据准确详细

### 2.4 积分管理模块

#### 2.4.1 积分扣减机制
**需求描述**: 根据任务类型自动扣减用户积分

**功能要求**:
- 支持多种付费模式配置
- 支持多种积分类型配置（比如普通积分、高级积分等，支持动态配置添加）
- 支持根据任务类型配置所需积分数量、积分类型
- 积分余额验证和扣减
- 积分交易原子性保证
- 积分扣减记录和审计

**验收标准**:
- 积分不足时禁止创建任务
- 积分扣减操作具有原子性
- 扣减记录完整准确
- 支持不同的付费模式

#### 2.4.2 积分分配管理
**需求描述**: 管理员向子账号分配积分功能

**功能要求**:
- 管理员可以向子账号分配积分
- 支持普通积分和高级积分
- 积分转移操作的安全性
- 防止并发操作导致的问题
- 积分分配历史记录

**验收标准**:
- 只有管理员可以分配积分
- 积分转移过程安全可靠
- 并发分配不会出现数据错误
- 分配记录可以追溯

#### 2.4.3 积分交易记录
**需求描述**: 完整记录所有积分变动情况

**功能要求**:
- 记录所有积分收入和支出
- 积分交易类型分类管理
- 积分使用统计和分析
- 积分余额实时查询
- 积分交易报表生成

**验收标准**:
- 积分变动记录完整无遗漏
- 积分余额计算准确
- 统计报表数据正确
- 查询响应速度快

### 2.5 三维模型管理模块

#### 2.5.1 模型信息管理
**需求描述**: 管理三维模型的基本信息和元数据

**功能要求**:
- 模型基本信息录入和编辑
- 模型分类和标签管理
- 模型状态控制和权限管理
- 模型搜索和筛选功能
- 模型统计和分析

**验收标准**:
- 模型信息录入界面友好
- 分类和标签功能完善
- 搜索结果准确快速
- 统计数据真实有效

#### 2.5.2 模型数据创建
**需求描述**: 根据AI计算结果自动创建模型数据

**功能要求**:
- 自动解析AI计算结果
- 创建对应的模型数据记录
- 支持多文件组成的复合模型
- 模型与任务的关联维护
- 模型创建失败的处理

**验收标准**:
- 模型数据创建自动准确
- 复合模型结构完整
- 关联关系正确维护
- 创建失败有明确提示

#### 2.5.3 模型展示配置
**需求描述**: 支持用户自定义模型展示属性

**功能要求**:
- 模型颜色、透明度配置
- 模型可见性控制
- 模型预览和详情查看
- 模型展示参数保存
- 模型分享和导出功能

**验收标准**:
- 展示配置实时生效
- 配置参数持久保存
- 模型预览效果良好
- 分享功能安全可控

### 2.6 实时通信模块

#### 2.6.1 WebSocket连接管理
**需求描述**: 建立稳定的实时通信连接

**功能要求**:
- 基于用户ID的连接管理
- 支持多终端同时连接
- 连接状态监控和维护
- 连接安全验证和授权
- 连接异常自动恢复

**验收标准**:
- 连接建立快速稳定
- 多终端连接互不干扰
- 连接中断能够自动恢复
- 安全验证有效可靠

#### 2.6.2 任务状态实时推送
**需求描述**: 实时推送任务状态变化信息

**功能要求**:
- 任务开始执行时通知用户
- 任务完成/失败即时推送
- 任务进度实时更新
- 错误信息及时通知
- 推送消息格式标准化

**验收标准**:
- 状态推送及时准确
- 推送消息格式规范
- 用户能够及时收到通知
- 推送不会丢失或重复

#### 2.6.3 消息推送服务
**需求描述**: 提供灵活的消息推送功能

**功能要求**:
- 点对点消息推送
- 广播消息功能
- 消息优先级管理
- 推送失败重试机制
- 消息推送状态跟踪

**验收标准**:
- 消息推送准确可靠
- 重试机制有效
- 推送状态可以跟踪
- 性能满足并发需求

### 2.7 计算引擎管理模块

#### 2.7.1 引擎注册和发现
**需求描述**: 管理AI计算引擎的注册和服务发现

**功能要求**:
- AI计算引擎自动注册
- 引擎能力信息管理
- 引擎状态实时监控
- 引擎下线和故障检测
- 引擎信息持久化存储

**验收标准**:
- 引擎注册过程自动化
- 引擎信息准确完整
- 状态监控实时有效
- 故障检测响应及时

#### 2.7.2 引擎负载均衡
**需求描述**: 实现智能的任务负载均衡分配

**功能要求**:
- 基于引擎负载选择最优引擎
- 支持多种负载均衡算法
- 引擎容量管理和保护
- 任务与引擎智能匹配
- 负载均衡效果监控

**验收标准**:
- 任务分配相对均匀
- 引擎不会过载
- 匹配算法准确有效
- 负载均衡可以调优

#### 2.7.3 引擎健康检查
**需求描述**: 持续监控引擎健康状态

**功能要求**:
- 定期心跳检测机制
- 引擎响应时间监控
- 引擎性能指标收集
- 异常引擎自动隔离
- 引擎恢复自动检测

**验收标准**:
- 心跳检测稳定可靠
- 性能指标准确详细
- 异常引擎及时隔离
- 恢复检测准确有效

## 3. 非功能需求

### 3.1 性能需求
- 系统响应时间：API接口平均响应时间 < 500ms
- 并发处理能力：支持1000个并发用户
- 文件上传性能：支持100MB文件5分钟内上传完成
- 数据库查询性能：复杂查询响应时间 < 2秒

### 3.2 可用性需求
- 系统可用性：99.5%以上
- 故障恢复时间：< 30分钟
- 数据备份：每日自动备份
- 容灾能力：支持异地灾备

### 3.3 安全需求
- 用户认证：JWT Token认证机制
- 数据加密：敏感数据加密存储
- 访问控制：基于角色的权限控制
- 审计日志：完整的操作审计记录

### 3.4 可扩展性需求
- 水平扩展：支持多实例部署
- 功能扩展：模块化设计，易于功能扩展
- 数据扩展：支持分库分表
- 接口扩展：标准化API接口设计

### 3.5 兼容性需求
- 浏览器兼容：支持主流浏览器最新版本
- 操作系统兼容：支持Linux、Windows部署
- 数据库兼容：兼容MySQL 8.0+
- Java版本：兼容JDK 1.8+

## 4. 系统约束

### 4.1 技术约束
- 开发语言：Java 8
- 开发框架：Spring Boot 2.7.4
- 数据库：MySQL 8.0
- 缓存：Redis
- 消息队列：RabbitMQ
- 文件存储：阿里云OSS

### 4.2 业务约束
- 用户数据隔离：严格的用户数据隔离
- 积分系统：积分不能透支
- 任务处理：任务执行必须可追溯
- 文件管理：文件访问必须授权

### 4.3 运维约束
- 部署方式：支持Docker容器化部署
- 监控要求：完整的系统监控体系
- 日志管理：结构化日志输出
- 备份策略：定期数据备份

## 5. 验收标准

### 5.1 功能验收
- 所有功能模块按需求实现
- 功能测试用例100%通过
- 集成测试验证系统协作
- 用户验收测试满足业务需求

### 5.2 性能验收
- 性能测试指标达到要求
- 压力测试验证系统稳定性
- 负载测试确认并发能力
- 容量测试验证扩展能力

### 5.3 安全验收
- 安全测试验证系统安全性
- 渗透测试发现潜在漏洞
- 权限测试确认访问控制
- 数据安全测试验证保护措施

## 6. 项目交付

### 6.1 交付物清单
- 系统源代码和技术文档
- 部署脚本和配置文件
- 用户操作手册
- 系统运维手册
- 测试报告和验收文档

### 6.2 部署要求
- 提供完整的部署指导
- 支持一键部署脚本
- 环境配置文档齐全
- 系统初始化脚本

### 6.3 培训支持
- 系统操作培训
- 运维管理培训
- 问题排查培训
- 技术文档支持

---

**文档版本**: v1.0  
**创建时间**: 2025-01-14  
**维护状态**: 正式版本 